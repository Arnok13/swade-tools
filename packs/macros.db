{"name":"Attack","permission":{"default":0,"lUyIFoEURZA7o1zQ":3},"type":"script","flags":{"core":{"sourceId":"Macro.ZX5N6znOIlQ4Sxlf"}},"scope":"global","command":"/// Macro to start attack sequence - shows quick list of weapons/powers for actor and roll main skill\nlet actor=canvas.tokens.controlled[0]?.actor\n\nif (!actor){\n    ui.notifications.warn(game.i18n.localize('SWADETOOLS.NoActorFound'));\n    \n} else {\n\n    let items=actor.items.filter(el=>(el.type==\"power\" || el.type==\"weapon\") && el.data.data.equipped===true);\n\n    if (!items.length){\n\n        ui.notifications.warn(game.i18n.localize('SWADETOOLS.NoItemEquipped'));\n    } else {\nlet buttons={}\n\nlet content=`<label style=\"font-size:14px;display:flex;align-items:center;margin-bottom: 5px;\"><input type=\"checkbox\" style=\"margin:0;vertical-align:middle;margin-right: 3px;\" id=\"showmore\"/> ${game.i18n.localize('SWADETOOLS.ShowDialogCheck')}</label>`\n\n\n\nitems.map((item)=>{\n    buttons[item.id]={\n        label: item.name,\n        callback: (html)=>{\n            let dialog=false;\n            if (html.find(\"#showmore\")[0].checked){\n                dialog=true;\n            } \n            game.swade.swadetoolsAttack(actor,item,dialog)\n            \n        }\n    }\n})\n\nnew Dialog({\n    title: actor.name+': '+game.i18n.localize(\"SWADE.QuickAccess\"),\n    content: content,\n    buttons: buttons,\nclasses: 'horizontal-dialog'\n},{classes:[\"vertical-buttons\"]}).render(true);\n    }\n}","author":"lUyIFoEURZA7o1zQ","img":"modules/swade-tools/icons/macro-attack.png","actorIds":[],"_id":"eYQOyUVzPFEh0Qe5"}
{"name":"PC Friendly / NPC Hostile","type":"script","author":"y2AqZ4TOZ3XmJRVR","img":"modules/swade-tools/icons/macro-disposition.png","scope":"global","command":"new Dialog({\n    title: 'PC Friendly / NPC Hostile',\n    content: `<p>${game.i18n.localize('SWADETOOLS.FriendlyPCMacroQuestion')}</p>`,\n    buttons: {\n        cancel: {\n            label: `<i class=\"fas fa-times\"></i> ${game.i18n.localize('SWADE.No')}`,\n            callback: ()=>{\n               \n            }\n        },\n        ok: {\n            label: `<i class=\"fas fa-check\"></i> ${game.i18n.localize('SWADE.Yes')}`,\n            callback: ()=>{\n                game.actors.forEach(actor=>{\n                    if (actor.data.type=='character'){\n                        actor.update({'token.disposition':1})\n                    } else if (actor.data.type=='npc'){\n                        actor.update({'token.disposition':-1})\n                    }\n                })\n\n                let chatData = {\n                    user: game.user._id,\n                    speaker:ChatMessage.getSpeaker(),\n                  content: `${game.i18n.localize('SWADETOOLS.FriendlyPCMacroOk')}`,\n               \n                };\n            \n                /* let chat=new ChatMessage();\n                chat.render(false,) */\n                return ChatMessage.create(chatData, {});\n\n            }\n        }\n\n        \n    }\n}).render(true);","folder":null,"sort":0,"permission":{"default":0,"y2AqZ4TOZ3XmJRVR":3},"flags":{"core":{"sourceId":"Macro.rJwLuJ2kQ1ZlFnJ2"}},"_id":"fYmdmESTwlns2lCM"}
{"name":"Roll From Selected","type":"script","author":"oOgyEd3SmzCGqEcz","img":"modules/swade-tools/icons/macro-selected.png","scope":"global","command":"const attrlang={\n    agility: \"AttrAgi\",\n    spirit:\"AttrSpr\",\n    strength: \"AttrStr\",\n    smarts:  \"AttrSma\",\n    vigor: \"AttrVig\"\n}\n\nconst attributes=['agility','smarts','spirit','strength','vigor']\n\nlet tokens=canvas.tokens.controlled;\n    if (tokens.length<1){\n        ui.notifications.warn(game.i18n.localize('SWADETOOLS.NoTokenSelected'))\n    } else {\n    let skillList=[]\n    let content=`<div class=\"swadetools-formpart swadetools-2grid\"><div class=\"swadetools-mod-add\"><label>${game.i18n.localize('SWADE.Trait')} </label> <select id=\"trait\">`;\n\n    content+=`<optgroup label=\"${game.i18n.localize('SWADE.Attributes')}\">`;\n    attributes.map(att=>{\n        content+=`<option value=\"att-${att}\">${game.i18n.localize('SWADE.'+attrlang[att])}</option>`;\n    })\n\n    content+=`</optgroup>\n    <optgroup label=\"${game.i18n.localize('SWADE.Skills')}\">`\n\n\n   // gb.log(tokens);\n\n    tokens.map(token=>{\n        token.actor.data.items.filter(el=>el.data.type=='skill').map(skill=>{\n                if (!skillList.includes(skill.name)){\n                content+=`<option value=\"skl-${skill.name}\">${skill.name}</option>`;\n                skillList.push(skill.name);\n                }\n            }\n        )\n        \n        \n    })\n\n\n\n\n    content+=`<option value=\"uns-unskilled\">${game.i18n.localize('SWADETOOLS.OtherUnskilled')}</option></select></optgroup></div>\n    <div class=\"swadetools-mod-add\"><label>${game.i18n.localize('SWADETOOLS.Modifier')} <i class=\"far fa-question-circle swadetools-hint\" title=\"${game.i18n.localize('SWADETOOLS.ModHint')}\"></i></label> <input type=\"text\" id=\"mod\"></div></div>`;\n\n    new Dialog({\n        title: \"Roll from Selected\",\n        content: content,\n        buttons: {\n            ok: {\n                label: `<i class=\"fas fa-dice\"></i> ${game.i18n.localize('SWADE.Roll')}`,\n                callback: (html)=>{\n                \n                    let val=html.find('#trait')[0].value\n                    let name=val.slice(4);\n                    let type=val.slice(0,4);\n                    let mod=html.find('#mod')[0].value\n\n                  //  gb.log(val,name,type);\n                        let att=false;\n                        if (type=='att-'){\n                        att=true;\n                        } else if (type=='uns-'){\n                        name='';\n                        }\n                    \n                    tokens.map(t=>{\n\n                        game.swade.swadetoolsRollTrait(t.actor,name,mod,att)\n\n                        \n\n                    })\n                }\n            }\n\n            \n        },\n        default: 'ok'\n    }).render(true);\n\n}","folder":null,"sort":0,"permission":{"default":0,"oOgyEd3SmzCGqEcz":3},"flags":{"core":{"sourceId":"Macro.br9hAWVjF1uGKLvN"}},"_id":"piWqfcNbrqVjmZGF"}
